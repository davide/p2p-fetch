<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>p2p-fetch demo - Lego Star Wars gallery</title>

    <link rel="stylesheet" href="style.css">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <h1>Lego Star Wars gallery</h1>

    <section id="images"></section>

    <script src="load-images.js"></script>
    <script type="text/javascript">
      if ('serviceWorker' in navigator) {

        const FETCH_PATTERN = encodeURIComponent('.*lego-gallery-dlmgouauwv.now.sh.+.jpg'),
              TIMEOUT = 30000,
              DB_NAME = encodeURIComponent('star-wars-gallery'),
              SERVER = encodeURIComponent('https://gun-server-gofcdhhtez.now.sh/gun');

        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'p2p-fetch.js?FETCH_PATTERN=' + FETCH_PATTERN + '&TIMEOUT=' + TIMEOUT + '&DB_NAME=' + DB_NAME + '&SERVER=' + SERVER;
        document.getElementsByTagName('head')[0].appendChild(script);

        document.body.addEventListener('p2p-fetch-ready', function(e){
          console.log('Lego Star Wars: serviceWorker ready! Loading images ...');
          loadImages();
        }, false);

      } else {
        console.log('Service workers are not supported.');
      }
    </script>
  </body>
</html>
